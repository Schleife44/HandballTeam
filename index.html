<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team-Tracker</title>
    <link rel="stylesheet" href="styles.css?v=2.8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body>

    <!-- Mobile Menu Toggle Button -->
    <button id="mobileMenuBtn" class="mobile-menu-btn">☰</button>

    <!-- Sidebar Overlay -->
    <div id="sidebarOverlay" class="sidebar-overlay"></div>

    <!-- Sidebar Navigation -->
    <div id="sidebar">
        <div class="sidebar-header">
            <h2>HANDBALL<br>DASHBOARD</h2>
        </div>
        <nav class="sidebar-nav">
            <div class="nav-group-label">Basis</div>
            <div class="nav-item active" data-view="dashboard">
                <span class="nav-icon"><i data-lucide="layout-dashboard"></i></span>
                <span class="nav-label">Überblick</span>
            </div>
            <div class="nav-item" data-view="game">
                <span class="nav-icon"><i data-lucide="play-circle"></i></span>
                <span class="nav-label">Spiel</span>
                <span id="sidebarTimer" class="sidebar-timer versteckt">00:00</span>
            </div>
            <div class="nav-item" data-view="roster">
                <span class="nav-icon"><i data-lucide="users"></i></span>
                <span class="nav-label">Kader</span>
            </div>

            <div class="nav-group-label">Live Analyse</div>
            <div class="nav-item" data-view="overview">
                <span class="nav-icon"><i data-lucide="bar-chart-2"></i></span>
                <span class="nav-label">Übersicht</span>
            </div>
            <div class="nav-item" data-view="shots">
                <span class="nav-icon"><i data-lucide="crosshair"></i></span>
                <span class="nav-label">Wurfbilder</span>
            </div>
            <div class="nav-item" data-view="heatmap">
                <span class="nav-icon"><i data-lucide="flame"></i></span>
                <span class="nav-label">Heatmap</span>
            </div>
            <div class="nav-item" data-view="protocol">
                <span class="nav-icon"><i data-lucide="list"></i></span>
                <span class="nav-label">Protokoll</span>
            </div>

            <div class="nav-group-label">Archiv</div>
            <div class="nav-item" data-view="history">
                <span class="nav-icon"><i data-lucide="history"></i></span>
                <span class="nav-label">Historie</span>
            </div>
            <div class="nav-item" data-view="season">
                <span class="nav-icon"><i data-lucide="trophy"></i></span>
                <span class="nav-label">Saison</span>
            </div>
            <div class="nav-item" data-view="seasonheatmap">
                <span class="nav-icon"><i data-lucide="activity"></i></span>
                <span class="nav-label">Saison-Heatmap</span>
            </div>
            <div class="nav-item" data-view="teamdiagramm">
                <span class="nav-icon"><i data-lucide="trending-up"></i></span>
                <span class="nav-label">Team Diagramm</span>
            </div>

            <div class="nav-group-label">System</div>

            <div class="nav-item" data-view="settings">
                <span class="nav-icon"><i data-lucide="settings"></i></span>
                <span class="nav-label">Einstellungen</span>
            </div>
        </nav>
    </div>

    <!-- Main Content Area -->
    <div id="main-content">

        <div id="rosterBereich" class="content-section versteckt">
            <!-- Roster Top Section -->
            <div class="roster-top-section">
                <!-- Team Namen Eingabe -->
                <div class="roster-form-card" style="margin-bottom: 20px;">
                    <div class="roster-form-grid" style="grid-template-columns: 1fr 1fr;">
                        <div class="roster-input-group">
                            <label for="rosterTeamNameHeim">Heim Team Name</label>
                            <input type="text" id="rosterTeamNameHeim" placeholder="Heim Team">
                        </div>
                        <div class="roster-input-group">
                            <label for="rosterTeamNameGegner">Gast Team Name</label>
                            <input type="text" id="rosterTeamNameGegner" placeholder="Gast Team">
                        </div>
                    </div>
                </div>

                <!-- Add Player Card -->
                <div class="roster-form-card" style="padding: 1rem;">
                    <div class="roster-form-header" style="margin-bottom: 1rem;">
                        <h2 style="margin:0; font-size: 1.2rem;">Kader verwalten</h2>
                    </div>
                    <!-- Compact Form - Single Row -->
                    <form id="addPlayerForm" style="display: flex; gap: 10px; align-items: flex-end;">
                        <input type="hidden" id="editPlayerIndex">
                        <div style="flex: 2;">
                            <label for="playerNameInput"
                                style="font-size: 0.8rem; display: block; margin-bottom: 4px;">Name</label>
                            <input type="text" id="playerNameInput" class="shadcn-input" placeholder="Spielername">
                        </div>
                        <div style="flex: 1; min-width: 70px;">
                            <label for="playerNumberInput"
                                style="font-size: 0.8rem; display: block; margin-bottom: 4px;">Nummer</label>
                            <input type="number" id="playerNumberInput" class="shadcn-input" placeholder="#" min="1"
                                max="99">
                        </div>
                        <div>
                            <button type="submit" class="shadcn-btn-primary" style="height: 40px;">Hinzufügen</button>
                            <button type="button" id="cancelEditButton" class="shadcn-btn-outline versteckt"
                                style="height: 40px;">Abbrechen</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Roster Bottom Section -->
            <div class="roster-bottom-section">
                <!-- Team Management Actions -->
                <div class="roster-manage-grid">
                    <button id="exportTeamButton" class="shadcn-btn-outline">Team exportieren</button>
                    <button id="importTeamButton" class="shadcn-btn-outline">Team importieren</button>
                    <input type="file" id="importFileInput" class="versteckt" accept=".json">
                    <button id="saveTeamButton" class="shadcn-btn-outline"
                        style="border-color: #22c55e; color: #22c55e;">
                        Team speichern</button>
                    <button id="loadTeamButton" class="shadcn-btn-outline"
                        style="border-color: #3b82f6; color: #3b82f6;">
                        Team laden</button>
                </div>

                <!-- Roster List Header -->
                <div
                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding: 0 10px;">
                    <h2 id="teamHeaderTitle" style="margin: 0; font-size: 1.6rem; font-weight: 800;">Heim Team</h2>
                    <div
                        style="display: flex; align-items: center; gap: 12px; background: var(--bg-card); padding: 8px 15px; border-radius: 12px; border: 1px solid var(--border-color);">
                        <span style="font-size: 0.85rem; font-weight: 600; color: var(--text-muted);">HEIM</span>
                        <button id="teamToggle" role="switch" aria-checked="false" data-state="unchecked"
                            class="shadcn-switch">
                            <span class="shadcn-switch-thumb"></span>
                        </button>
                        <span style="font-size: 0.85rem; font-weight: 600; color: var(--text-muted);">GAST</span>
                    </div>
                </div>

                <!-- Player Cards Grid -->
                <div id="rosterListe" class="roster-grid"></div>

                <!-- Danger Zone -->
                <div style="margin-top: 40px; border-top: 1px solid var(--border-color); padding-top: 20px;">
                    <button id="deleteTeamButton" class="shadcn-btn-outline roster-delete-btn"
                        style="width: 100%; max-width: 300px; margin: 0 auto; height: 44px;">Aktuelles Team
                        löschen</button>
                </div>
            </div>
        </div>

        <!-- Live Overview Page Section -->
        <div id="liveOverviewBereich" class="content-section versteckt">
            <div id="liveOverviewContent"></div>
        </div>

        <!-- Season Overview Page Section -->
        <div id="seasonBereich" class="content-section versteckt">
            <h2>Saisonstatistiken</h2>
            <div id="seasonContent"></div>
        </div>

        <!-- Team Diagramm Page Section (New) -->
        <div id="teamDiagrammBereich" class="content-section versteckt">
            <h2>Team Vergleich</h2>
            <div id="teamDiagrammContent"></div>
        </div>

        <!-- Shot Charts Page Section -->
        <div id="shotsBereich" class="content-section versteckt">
            <h2>Wurfbilder</h2>
            <div id="shotsContent"></div>
        </div>

        <!-- Live Heatmap Page Section -->
        <div id="liveHeatmapBereich" class="content-section versteckt">
            <div class="heatmap-view-container">
                <div class="heatmap-view-header">
                    <h1>Live Heatmap-Analyse</h1>
                </div>

                <div class="heatmap-controls-card">
                    <!-- Row 1: Selects -->
                    <div class="heatmap-row">
                        <div class="roster-input-group">
                            <label>Team</label>
                            <div
                                style="display: flex; align-items: center; gap: 12px; height: 40px; background: hsl(var(--muted)/0.3); padding: 0 15px; border-radius: 8px; border: 1px solid hsl(var(--border)); width: fit-content;">
                                <span id="heatmapHeimLabel"
                                    style="font-size: 0.85rem; font-weight: 600; color: hsl(var(--muted-foreground));">HEIM</span>
                                <button id="heatmapTeamToggle" role="switch" aria-checked="false" data-state="unchecked"
                                    class="shadcn-switch">
                                    <span class="shadcn-switch-thumb"></span>
                                </button>
                                <span id="heatmapGegnerLabel"
                                    style="font-size: 0.85rem; font-weight: 600; color: hsl(var(--muted-foreground));">GAST</span>
                            </div>
                        </div>
                        <div class="roster-input-group">
                            <label>Spieler</label>
                            <select id="heatmapPlayerSelect" class="shadcn-input shadcn-select-native">
                                <option value="all">Alle Spieler</option>
                            </select>
                        </div>
                    </div>

                    <!-- Row 2: Tabs -->
                    <div class="heatmap-tabs-row">
                        <button class="heatmap-tab white-style active" data-tab="tor">Tor-Ansicht</button>
                        <button class="heatmap-tab white-style" data-tab="feld">Wurf-Positionen</button>
                        <button class="heatmap-tab white-style" data-tab="kombiniert">Kombiniert</button>
                    </div>

                    <!-- Row 3: Filters -->
                    <div class="heatmap-filters-row">
                        <label class="heatmap-filter-item">
                            <input type="checkbox" id="heatmapToreFilter" checked> Feldtore
                        </label>
                        <label class="heatmap-filter-item">
                            <input type="checkbox" id="heatmap7mFilter"> 7m
                        </label>
                        <label class="heatmap-filter-item">
                            <input type="checkbox" id="heatmapMissedFilter" checked> Fehlwürfe
                        </label>
                    </div>
                </div>

                <div class="heatmap-visual-container">
                    <svg id="heatmapSvg" viewBox="0 0 300 200" width="600" height="400"></svg>
                </div>
            </div>
        </div>

        <!-- Protocol Page Section -->
        <div id="protokollBereich" class="content-section versteckt">
            <div style="max-width: 1000px; margin: 0 auto; padding: 20px;">
                <h1>Spielprotokoll</h1>
                <div id="protokoll" class="protocol-card">
                    <div class="protocol-header">
                        <h3 class="player-card-title">Live Ticker</h3>
                    </div>
                    <div id="protokollAusgabe"></div>
                </div>
            </div>
        </div>

        <!-- Export Page Section -->
        <div id="exportBereich" class="versteckt">
            <h2>Export</h2>
            <div id="exportContent" style="padding: 20px;"></div>
        </div>

        <!-- Settings Page Section -->
        <div id="settingsBereich" class="versteckt">
            <div style="padding: 20px; max-width: 800px; margin: 0 auto;">
                <h2>Einstellungen</h2>

                <div
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                    <!-- Card 1: Team Settings -->
                    <div class="settings-card"
                        style="background: var(--bg-container); padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        <h4
                            style="margin-top: 0; margin-bottom: 15px; border-bottom: 2px solid var(--btn-primary); padding-bottom: 10px; display: inline-block;">
                            Teams</h4>
                        <div style="display:flex; gap:15px; flex-wrap: wrap;">
                            <div style="flex:1; min-width: 200px;">
                                <label for="inputTeamNameHeim"
                                    style="display:block; font-size:0.9rem; margin-bottom:8px; font-weight: 500;">Heim
                                    Team</label>
                                <input type="text" id="inputTeamNameHeim" placeholder="Heim Team"
                                    style="width: 100%; box-sizing: border-box; margin: 0;">
                            </div>
                            <div style="flex:1; min-width: 200px;">
                                <label for="inputTeamNameGegner"
                                    style="display:block; font-size:0.9rem; margin-bottom:8px; font-weight: 500;">Gast
                                    Team</label>
                                <input type="text" id="inputTeamNameGegner" placeholder="Gast Team"
                                    style="width: 100%; box-sizing: border-box; margin: 0;">
                            </div>
                        </div>
                    </div>

                    <!-- Card 2: General Settings -->
                    <div class="settings-card"
                        style="background: var(--bg-container); padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        <h4
                            style="margin-top: 0; margin-bottom: 15px; border-bottom: 2px solid var(--btn-purple); padding-bottom: 10px; display: inline-block;">
                            Allgemein</h4>
                        <div class="setting-row"
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <label for="toggleDarkMode" style="cursor: pointer;">Dark Mode</label>
                            <label class="switch">
                                <input type="checkbox" id="toggleDarkMode">
                                <span class="slider round"></span>
                            </label>
                        </div>
                        <div class="setting-row"
                            style="display: flex; justify-content: space-between; align-items: center;">
                            <label for="toggleAuswaertsspiel" style="cursor: pointer;">Seiten tauschen</label>
                            <label class="switch">
                                <input type="checkbox" id="toggleAuswaertsspiel">
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </div>



                    <!-- Card 4: Wurfbilder -->
                    <div class="settings-card"
                        style="background: var(--bg-container); padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        <h4
                            style="margin-top: 0; margin-bottom: 15px; border-bottom: 2px solid var(--btn-danger); padding-bottom: 10px; display: inline-block;">
                            Wurfbilder (Popups)</h4>
                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <div class="setting-row"
                                style="display: flex; justify-content: space-between; align-items: center;">
                                <label for="toggleWurfbildHeim" style="cursor: pointer;">Wurfbild: Heim</label>
                                <label class="switch">
                                    <input type="checkbox" id="toggleWurfbildHeim">
                                    <span class="slider round"></span>
                                </label>
                            </div>
                            <div class="setting-row"
                                style="display: flex; justify-content: space-between; align-items: center;">
                                <label for="toggleWurfbildGegner" style="cursor: pointer;">Wurfbild:
                                    Gast</label>
                                <label class="switch">
                                    <input type="checkbox" id="toggleWurfbildGegner">
                                    <span class="slider round"></span>
                                </label>
                            </div>
                            <div style="height: 1px; background: var(--border-color); margin: 5px 0;"></div>
                            <div class="setting-row"
                                style="display: flex; justify-content: space-between; align-items: center;">
                                <label for="toggleWurfpositionHeim" style="cursor: pointer;">Position:
                                    Heim</label>
                                <label class="switch">
                                    <input type="checkbox" id="toggleWurfpositionHeim">
                                    <span class="slider round"></span>
                                </label>
                            </div>
                            <div class="setting-row"
                                style="display: flex; justify-content: space-between; align-items: center;">
                                <label for="toggleWurfpositionGegner" style="cursor: pointer;">Position:
                                    Gast</label>
                                <label class="switch">
                                    <input type="checkbox" id="toggleWurfpositionGegner">
                                    <span class="slider round"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="spielBereich" class="versteckt">
            <div class="game-layout">
                <!-- Top Row: Admin Controls -->
                <div
                    style="display: flex; flex-direction: column; align-items: center; gap: 15px; margin-bottom: 20px;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; width: 100%; max-width: 800px;">
                        <button id="neuesSpielButton" class="shadcn-btn-outline">Neues Spiel</button>
                        <button id="gameSwapSidesBtn" class="shadcn-btn-outline" style="margin: 0;">Seiten
                            tauschen</button>
                    </div>
                    <!-- Sidebar is still here but layout changed a bit, let's keep it functional -->
                    <aside id="statistikSidebar" class="versteckt"
                        style="position: static; flex-basis: auto; width: auto; box-shadow: none; padding: 0;">
                        <!-- Content moved to a more central place or integrated into cards? 
                             Actually, let's keep the tracker logic as is but style it as a card if visible. -->
                        <div id="statistikWrapper" class="protocol-card versteckt" style="margin: 0; min-width: 300px;">
                            <h3 class="player-card-title">Live Statistik</h3>
                            <div class="table-container" style="max-height: 200px; overflow-y: auto;">
                                <table id="statistikTabelle" class="modern-stats-table">
                                    <thead>
                                        <tr>
                                            <th>Spieler</th>
                                            <th>7m</th>
                                            <th>Gut</th>
                                            <th>Fehl</th>
                                            <th>TF</th>
                                            <th>G</th>
                                            <th>2'</th>
                                            <th>R</th>
                                        </tr>
                                    </thead>
                                    <tbody id="statistikTabelleBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </aside>
                </div>

                <!-- Main Scoreboard -->
                <div id="timerContainer" class="game-scoreboard">
                    <div id="timerAnzeige" class="scoreboard-timer">00:00</div>

                    <div id="suspensionContainer"></div>

                    <div id="scoreWrapper" class="scoreboard-main versteckt">
                        <div class="scoreboard-team home">
                            <span id="teamNameHeimDisplay" class="scoreboard-team-name">HEIM</span>
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <div class="score-team-control"
                                    style="display: flex; flex-direction: column; gap: 4px;">
                                    <button id="heimScoreUp" class="shadcn-btn-outline shadcn-btn-xs"
                                        style="padding: 0; min-width: 24px;" disabled>+</button>
                                    <button id="heimScoreDown" class="shadcn-btn-outline shadcn-btn-xs"
                                        style="padding: 0; min-width: 24px;" disabled>-</button>
                                </div>
                                <span id="scoreAnzeige" class="scoreboard-score">0</span>
                            </div>
                        </div>

                        <div class="scoreboard-divider">:</div>

                        <div class="scoreboard-team away">
                            <span id="teamNameGegnerDisplay" class="scoreboard-team-name">GAST</span>
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <span id="scoreAnzeigeGegner" class="scoreboard-score">0</span>
                                <div class="score-team-control"
                                    style="display: flex; flex-direction: column; gap: 4px;">
                                    <button id="gegnerScoreUp" class="shadcn-btn-outline shadcn-btn-xs"
                                        style="padding: 0; min-width: 24px;" disabled>+</button>
                                    <button id="gegnerScoreDown" class="shadcn-btn-outline shadcn-btn-xs"
                                        style="padding: 0; min-width: 24px;" disabled>-</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="scoreboard-controls">
                        <div id="zeitSprung">
                            <button id="zurueckButton" class="shadcn-btn-outline shadcn-btn-sm">-30s</button>
                            <button id="pauseButton" class="shadcn-btn-outline shadcn-btn-sm versteckt"
                                disabled>Pause</button>
                            <button id="vorButton" class="shadcn-btn-outline shadcn-btn-sm">+30s</button>
                        </div>
                        <button id="gamePhaseButton" class="shadcn-btn-primary">Spielstart</button>
                    </div>
                </div>

                <!-- Player Selection Cards -->
                <div id="spielerAuswahlContainer" class="player-grid-container">
                    <div class="player-card">
                        <div class="player-card-header">
                            <h4 id="labelSpielerHeimRaster" class="player-card-title">Heim</h4>
                        </div>
                        <div id="heimSpielerRaster" class="spieler-raster"></div>
                    </div>

                    <div class="player-card">
                        <div class="player-card-header">
                            <h4 id="labelSpielerGegnerRaster" class="player-card-title">Gast</h4>
                        </div>
                        <div id="gegnerSpielerRaster" class="spieler-raster"></div>
                    </div>
                </div>

                <!-- Protocol and Finish -->
                <div style="max-width: 1100px; margin: 0 auto; display: flex; flex-direction: column; gap: 20px;">
                    <!-- Trackers and Finish Button -->
                    <div style="display: flex; flex-direction: column; gap: 20px;">

                        <button id="spielBeendenButton" class="cta-button"
                            style="width: 100%; margin: 0; background-color: #343a40;">Spiel beenden &
                            speichern</button>
                    </div>


                </div>
            </div>
        </div>


        <!-- Vergangene Spiele -->
        <div id="historieBereich" class="versteckt">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h1>Vergangene Spiele</h1>
                <!-- Back button removed -->
            </div>

            <div id="historieListe" class="history-list">
                <p>Keine gespeicherten Spiele.</p>
            </div>

            <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                <button id="importSpielButton" class="shadcn-btn-primary">Spiel importieren</button>
                <input type="file" id="importSpielInput" class="versteckt" accept=".json">
                <button id="exportHistorieButton" class="shadcn-btn-outline">Alle Spiele exportieren (Backup)</button>
            </div>
        </div>

        <!-- Vergangene Spiele Deitail -->
        <div id="historieDetailBereich" class="versteckt">
            <button id="backToHistoryList" class="shadcn-btn-outline">Zurück zur Liste</button>

            <!-- The header is now dynamically managed in historyView.js via a 'score-card' to match live overview -->
            <div id="historieHeader" class="versteckt"></div>

            <div class="heatmap-tabs">
                <button class="heatmap-tab shadcn-btn-outline active" id="histTabStats">Statistik</button>
                <button class="heatmap-tab shadcn-btn-outline" id="histTabHeatmap">Heatmap</button>
            </div>

            <!-- Detail: Stats -->
            <div id="histContentStats">
                <div class="statistik-container">
                    <table id="histStatsTable">
                        <thead>
                            <tr>
                                <th>Spieler</th>
                                <th>Tor</th>
                                <th>Feldtore</th>
                                <th>7m</th>
                                <th>Fehlwurf</th>
                                <th>Quote</th>
                                <th>Gut</th>
                                <th>TF</th>
                                <th>G</th>
                                <th>2'</th>
                                <th>R</th>
                            </tr>
                        </thead>
                        <tbody id="histStatsBody"></tbody>
                    </table>

                    <h3 style="margin-top: 20px;">Gast</h3>
                    <table id="histStatsGegnerTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Tor</th>
                                <th>Feldtore</th>
                                <th>7m</th>
                                <th>Fehlwurf</th>
                                <th>Quote</th>
                                <th>Gut</th>
                                <th>TF</th>
                                <th>G</th>
                                <th>2'</th>
                                <th>R</th>
                            </tr>
                        </thead>
                        <tbody id="histStatsGegnerBody"></tbody>
                    </table>
                </div>
            </div>

            <!-- Detail: Heatmap -->
            <div id="histContentHeatmap" class="versteckt" style="text-align: center;">
                <div class="heatmap-tabs" style="margin-top: 10px;">
                    <button class="heatmap-tab shadcn-btn-outline active" id="histSubTabTor">Tor</button>
                    <button class="heatmap-tab shadcn-btn-outline" id="histSubTabFeld">Feld</button>
                    <button class="heatmap-tab shadcn-btn-outline" id="histSubTabKombi">Kombiniert</button>
                </div>
                <div class="heatmap-filter">
                    <label><input type="radio" name="histHeatTeam" value="heim" checked> Heim</label>
                    <label><input type="radio" name="histHeatTeam" value="gegner"> Gast</label>
                    <span style="margin: 0 10px;">|</span>
                    <label><input type="checkbox" id="histHeatmapToreFilter" checked> Feldtore</label>
                    <label><input type="checkbox" id="histHeatmap7mFilter"> 7m</label>
                    <label><input type="checkbox" id="histHeatmapMissedFilter" checked> Fehlwürfe</label>
                </div>
                <div id="histHeatmapContainer" style="display: flex; justify-content: center; padding: 20px;">
                    <svg id="histHeatmapSvg" viewBox="0 0 300 200" width="600" height="400"></svg>
                </div>
            </div>
        </div>


        <div id="aktionsMenue" class="modal-overlay versteckt">
            <div class="shadcn-modal-content">
                <div class="shadcn-modal-header">
                    <h3 id="aktionsMenueTitel">Aktion wählen</h3>
                </div>
                <div class="shadcn-modal-body"
                    style="display: flex; flex-direction: column; gap: 8px; margin-top: 1rem;">
                    <button class="shadcn-btn-outline" data-aktion="Tor">Tor</button>
                    <button class="shadcn-btn-outline" data-aktion="Fehlwurf">Fehlwurf</button>
                    <button class="shadcn-btn-outline" data-aktion="7m">7m</button>
                    <button class="shadcn-btn-outline" id="guteAktionModalButton">Gute Aktion</button>
                    <button class="shadcn-btn-outline" data-aktion="Fehlpass">Fehlpass</button>
                    <button class="shadcn-btn-outline" data-aktion="Technischer Fehler">Technischer Fehler</button>
                    <button class="shadcn-btn-outline strafe-gelb" data-aktion="Gelbe Karte">Gelbe Karte</button>
                    <button class="shadcn-btn-outline strafe-zeit" data-aktion="2 Minuten">2 Minuten</button>
                    <button class="shadcn-btn-outline strafe-rot" data-aktion="Rote Karte">Rote Karte</button>
                </div>
                <div class="shadcn-modal-footer">
                    <button class="shadcn-btn-outline" id="aktionAbbrechen" style="width: 100%;">Abbrechen</button>
                </div>
            </div>
        </div>

        <div id="aktionVorauswahl" class="modal-overlay versteckt">
            <div class="shadcn-modal-content">
                <div class="shadcn-modal-header">
                    <h3>Gute Aktion</h3>
                </div>
                <div class="shadcn-modal-body"
                    style="display: flex; flex-direction: column; gap: 8px; margin-top: 1rem;">
                    <button class="shadcn-btn-outline" data-aktion="Abwehr">Abwehr</button>
                    <button class="shadcn-btn-outline" data-aktion="7M Rausgeholt">7M Rausgeholt</button>
                    <button class="shadcn-btn-outline" data-aktion="TG Pass">TG Pass</button>
                    <button class="shadcn-btn-outline" data-aktion="Guter Pass">Guter Pass</button>
                    <button class="shadcn-btn-outline" data-aktion="Anderes">Anderes</button>
                </div>
                <div class="shadcn-modal-footer">
                    <button class="shadcn-btn-outline" id="aktionVorauswahlAbbrechen"
                        style="width: 100%;">Zurück</button>
                </div>
            </div>
        </div>

        <!-- Comment Modal (Shadcn Style) -->
        <div id="kommentarBereich" class="modal-overlay versteckt">
            <div class="shadcn-modal-content">
                <div class="shadcn-modal-header">
                    <h3 id="kommentarTitel">Kommentar (optional)</h3>
                </div>
                <div class="shadcn-modal-body"
                    style="margin-top: 1rem; display: flex; flex-direction: column; gap: 8px;">
                    <input type="text" id="kommentarInput" placeholder="Beschreibe die Aktion..." class="shadcn-input">
                </div>
                <div class="shadcn-modal-footer">
                    <button class="shadcn-btn-primary" id="kommentarSpeichernButton">Speichern</button>
                </div>
            </div>
        </div>


        <!-- Wurfbild Modal (Shadcn Style) -->
        <div id="wurfbildModal" class="modal-overlay versteckt">
            <div class="shadcn-modal-content">
                <div class="shadcn-modal-header">
                    <h3 id="wurfbildTitel">Wo ging der Ball rein?</h3>
                </div>
                <!-- Content (Goal SVG) -->
                <div id="wurfbildUmgebung" style="margin-top: 1rem; display: flex; justify-content: center;">
                    <svg id="inputGoalSvg" viewBox="0 0 300 200"
                        style="width: 100%; height: auto; max-width: 400px; display: block; margin: 0 auto; background-color: transparent;">
                        <!-- Goal Frame (Matches Heatmap) -->
                        <rect x="25" y="10" width="250" height="180" fill="none" stroke="#888" stroke-width="3" />
                        <line x1="100" y1="10" x2="100" y2="190" stroke="#bbb" stroke-width="1"
                            stroke-dasharray="5,5" />
                        <line x1="200" y1="10" x2="200" y2="190" stroke="#bbb" stroke-width="1"
                            stroke-dasharray="5,5" />
                        <line x1="25" y1="70" x2="275" y2="70" stroke="#bbb" stroke-width="1" stroke-dasharray="5,5" />
                        <line x1="25" y1="130" x2="275" y2="130" stroke="#bbb" stroke-width="1"
                            stroke-dasharray="5,5" />
                    </svg>
                </div>
                <div class="shadcn-modal-footer">
                    <button class="shadcn-btn-outline" id="wurfbildUeberspringen">Überspringen</button>
                </div>
            </div>
        </div>

        <!-- Wurfposition Modal (Shadcn Style) -->
        <div id="wurfpositionModal" class="modal-overlay versteckt">
            <div class="shadcn-modal-content">
                <div class="shadcn-modal-header">
                    <h3>Von wo wurde geworfen?</h3>
                </div>
                <div id="wurfpositionFeld" style="margin-top: 1rem; display: flex; justify-content: center;">
                    <svg viewBox="0 0 300 400" width="100%" style="max-height: 50vh;">
                        <!-- Spielfeld Hälfte (Matching Heatmap Output) -->
                        <rect x="10" y="10" width="280" height="380" fill="#f5f5f5" stroke="#333" stroke-width="2" />

                        <!-- Tor oben (Mitte) -->
                        <rect x="112" y="10" width="76" height="8" fill="#333" />

                        <!-- 6m Linie (Torraum - durchgezogen) -->
                        <path d="M 75 18 Q 75 90 150 90 Q 225 90 225 18" fill="none" stroke="#333" stroke-width="2" />

                        <!-- 9m Linie (Freiwurflinie - gestrichelt) -->
                        <path d="M 37 18 Q 37 150 150 150 Q 263 150 263 18" fill="none" stroke="#333" stroke-width="1"
                            stroke-dasharray="6,3" />

                        <!-- 7m Punkt -->
                        <circle cx="150" cy="65" r="4" fill="#333" />

                        <!-- Mittellinie -->
                        <line x1="10" y1="388" x2="290" y2="388" stroke="#333" stroke-width="2" />
                    </svg>
                </div>
                <div class="shadcn-modal-footer">
                    <button class="shadcn-btn-outline" id="wurfpositionUeberspringen">Überspringen</button>
                </div>
            </div>
        </div>

        <!-- Opponent Number Modal (Shadcn Style) -->
        <div id="gegnerNummerModal" class="modal-overlay versteckt">
            <div class="shadcn-modal-content">
                <div class="shadcn-modal-header">
                    <h3 id="gegnerNummerTitel">Torschütze (Gast)</h3>
                </div>
                <div class="shadcn-modal-body" style="margin-top: 1rem;">
                    <div id="bekannteGegnerListe"
                        style="display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 1rem;"></div>
                    <div
                        style="border-top: 1px solid hsl(var(--border)); padding-top: 10px; display: flex; flex-direction: column; gap: 10px;">
                        <input type="number" id="neueGegnerNummer" placeholder="Neue Nummer" class="shadcn-input">
                        <input type="text" id="neueGegnerName" placeholder="Name (optional)" class="shadcn-input">
                    </div>
                </div>
                <div class="shadcn-modal-footer">
                    <button class="shadcn-btn-outline" id="gegnerNummerUeberspringen">Unbekannt / Weiter</button>
                    <button class="shadcn-btn-primary" id="gegnerNummerSpeichern">Weiter</button>
                </div>
            </div>
        </div>

        <!-- Quick Add Home Player Modal (during game) -->
        <!-- Quick Add Home Player Modal (Shadcn Style) -->
        <div id="quickAddPlayerModal" class="modal-overlay versteckt">
            <div class="shadcn-modal-content">
                <div class="shadcn-modal-header">
                    <h3>Spieler hinzufügen</h3>
                    <p>Nummer und optional Name eingeben:</p>
                </div>
                <div class="shadcn-modal-body"
                    style="display: flex; flex-direction: column; gap: 10px; margin-top: 1rem;">
                    <input type="number" id="quickPlayerNumber" placeholder="Nummer" class="shadcn-input">
                    <input type="text" id="quickPlayerName" placeholder="Name (optional)" class="shadcn-input">
                </div>
                <div class="shadcn-modal-footer">
                    <button class="shadcn-btn-outline" id="quickAddPlayerCancel">Abbrechen</button>
                    <button class="shadcn-btn-primary" id="quickAddPlayerSave">Hinzufügen</button>
                </div>
            </div>
        </div>

        <!-- Save Team Name Modal -->
        <!-- Save Team Name Modal (Shadcn Style) -->
        <div id="saveTeamNameModal" class="modal-overlay versteckt">
            <div class="shadcn-modal-content">
                <div class="shadcn-modal-header">
                    <h3>Team speichern</h3>
                    <p>Gib einen Namen für das Team ein:</p>
                </div>
                <div class="shadcn-modal-body" style="margin-top: 1rem;">
                    <input type="text" id="saveTeamNameInput" placeholder="Team Name" class="shadcn-input">
                </div>
                <div class="shadcn-modal-footer">
                    <button class="shadcn-btn-outline" id="saveTeamNameCancel">Abbrechen</button>
                    <button class="shadcn-btn-primary" id="saveTeamNameConfirm">Speichern</button>
                </div>
            </div>
        </div>

        <!-- View/Edit Team Modal -->
        <!-- View/Edit Team Modal (Shadcn Style) -->
        <div id="viewTeamModal" class="modal-overlay versteckt">
            <div class="shadcn-modal-content" style="max-width: 600px;">
                <div class="shadcn-modal-header">
                    <h3 id="viewTeamTitle">Team anschauen</h3>
                </div>
                <div class="shadcn-modal-body" style="margin-top: 1rem;">
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Team Name:</label>
                        <input type="text" id="editTeamNameInput" placeholder="Team Name" class="shadcn-input">
                    </div>
                    <div id="viewTeamPlayersList" style="max-height: 300px; overflow-y: auto; margin: 15px 0;">
                        <!-- Players will be listed here -->
                    </div>
                </div>
                <div class="shadcn-modal-footer">
                    <button class="shadcn-btn-outline" id="viewTeamClose" style="flex: 1;">Schließen</button>
                    <button class="shadcn-btn-primary" id="saveTeamChanges"
                        style="flex: 1; background-color: #28a745;">Änderungen speichern</button>
                </div>
            </div>
        </div>

        <!-- Season Overview Modal -->
        <!-- Season Overview Modal (Shadcn Style) -->
        <div id="seasonOverviewModal" class="modal-overlay versteckt">
            <div class="shadcn-modal-content"
                style="max-width: 900px; max-height: 90vh; display: flex; flex-direction: column;">
                <div class="shadcn-modal-header">
                    <h2>Saison-Übersicht</h2>
                </div>
                <div class="shadcn-modal-body" style="overflow-y: auto; flex: 1;">
                    <div id="seasonSummary"
                        style="margin: 15px 0; padding: 10px; background-color: var(--bg-secondary); border-radius: 5px;">
                        <!-- Summary stats -->
                    </div>
                    <div id="seasonStatsContainer" style="margin-top: 20px;">
                        <!-- Player cards will be rendered here -->
                    </div>
                </div>
                <div class="shadcn-modal-footer">
                    <button class="shadcn-btn-outline" id="seasonOverviewClose">Schließen</button>
                </div>
            </div>
        </div>



        <!-- Load Team Modal -->
        <!-- Load Team Modal (Shadcn Style) -->
        <div id="loadTeamModal" class="modal-overlay versteckt">
            <div class="shadcn-modal-content">
                <div class="shadcn-modal-header">
                    <h3>Gespeicherte Teams</h3>
                </div>
                <div class="shadcn-modal-body">
                    <div id="savedTeamsList" style="max-height: 300px; overflow-y: auto; margin: 15px 0;">
                        <!-- Teams will be listed here -->
                    </div>
                </div>
                <div class="shadcn-modal-footer">
                    <button class="shadcn-btn-outline" id="loadTeamCancel">Abbrechen</button>
                </div>
            </div>
        </div>

        <!-- Add Opponent Modal (Shadcn Style) -->
        <div id="addGegnerModal" class="modal-overlay versteckt">
            <div class="shadcn-modal-content">
                <div class="shadcn-modal-header">
                    <h3>Gegner hinzufügen</h3>
                    <p>Gib die Nummer und optional den Namen ein:</p>
                </div>
                <div class="shadcn-modal-body"
                    style="display: flex; flex-direction: column; gap: 10px; margin-top: 1rem;">
                    <input type="number" id="addGegnerNummerInput" placeholder="Nummer" class="shadcn-input">
                    <input type="text" id="addGegnerNameInput" placeholder="Name (optional)" class="shadcn-input">
                </div>
                <div class="shadcn-modal-footer">
                    <button class="shadcn-btn-outline" id="addGegnerAbbrechen">Abbrechen</button>
                    <button class="shadcn-btn-primary" id="addGegnerSpeichern">Hinzufügen</button>
                </div>
            </div>
        </div>

        <!-- 7m Outcome Modal (Shadcn Style) -->
        <div id="sevenMeterOutcomeModal" class="modal-overlay versteckt">
            <div class="shadcn-modal-content">
                <div class="shadcn-modal-header">
                    <h3>7m Ergebnis</h3>
                </div>
                <div class="shadcn-modal-body"
                    style="display: flex; flex-direction: column; gap: 8px; margin-top: 1rem;">
                    <button class="shadcn-btn-primary" data-outcome="Tor">Tor</button>
                    <button class="shadcn-btn-outline" data-outcome="Gehalten">Gehalten</button>
                    <button class="shadcn-btn-outline" data-outcome="Verworfen">Verworfen (Pfosten/Aus)</button>
                </div>
                <!-- No footer needed if actions are definitive, or add cancel if desired. Default existing didn't have explicit cancel -->
            </div>
        </div>

        <!-- Wurfbilder Stats Modal (Shadcn Style) -->
        <div id="wurfbilderStatsModal" class="modal-overlay versteckt">
            <div class="shadcn-modal-content" style="max-width: 500px; width: 95%;">
                <div class="shadcn-modal-header">
                    <h3>Wurfbilder Übersicht</h3>
                </div>
                <div class="shadcn-modal-body">
                    <div id="wurfbilderContainer" style="max-height: 60vh; overflow-y: auto;"></div>
                </div>
                <div class="shadcn-modal-footer">
                    <button class="shadcn-btn-outline" id="closeWurfbilderStats">Schließen</button>
                </div>
            </div>
        </div>

        <!-- Live Game Overview Modal (Shadcn Style) -->
        <div id="liveGameOverviewModal" class="modal-overlay versteckt">
            <div class="shadcn-modal-content"
                style="max-width: 900px; width: 95%; max-height: 90vh; display: flex; flex-direction: column;">
                <div class="shadcn-modal-header">
                    <h3>Spiel Übersicht (Aktuell)</h3>
                </div>
                <!-- Body needs to scroll -->
                <div class="shadcn-modal-body" style="overflow-y: auto; flex: 1;">
                    <!-- Score Header -->
                    <div class="live-overview-score-header"
                        style="margin-bottom: 24px; text-align: center; background: hsl(var(--muted)/0.3); padding: 20px; border-radius: 12px; border: 1px solid hsl(var(--border));">
                        <div style="display: flex; justify-content: space-around; align-items: center; gap: 20px;">
                            <div style="flex: 1;">
                                <div id="liveOverviewTeamHeim"
                                    style="font-size: 1.1rem; font-weight: 600; color: hsl(var(--primary));">HEIM</div>
                            </div>
                            <div
                                style="font-size: 2.5rem; font-weight: 800; letter-spacing: -1px; min-width: 120px; display: flex; justify-content: center; align-items: center; gap: 8px;">
                                <span id="liveOverviewScoreHeim">0</span>
                                <span style="color: hsl(var(--muted-foreground)); opacity: 0.5;">:</span>
                                <span id="liveOverviewScoreGegner">0</span>
                            </div>
                            <div style="flex: 1;">
                                <div id="liveOverviewTeamGegner"
                                    style="font-size: 1.1rem; font-weight: 600; color: #ef4444;">GEGNER</div>
                            </div>
                        </div>
                        <div id="liveOverviewTime"
                            style="margin-top: 8px; font-size: 0.9rem; font-weight: 500; color: hsl(var(--muted-foreground)); font-family: monospace;">
                            00:00</div>
                    </div>

                    <!-- Tabs -->
                    <div class="heatmap-tabs">
                        <button class="heatmap-tab shadcn-btn-outline active"
                            id="liveOverviewTabStats">Statistik</button>
                        <button class="heatmap-tab shadcn-btn-outline" id="liveOverviewTabHeatmap">Heatmap</button>
                    </div>

                    <!-- Content: Stats -->
                    <div id="liveOverviewContentStats">
                        <div class="statistik-container">
                            <table id="liveOverviewStatsTable">
                                <thead>
                                    <tr>
                                        <th>Spieler</th>
                                        <th>Tor</th>
                                        <th>Feldtore</th>
                                        <th>7m</th>
                                        <th>Fehlwurf</th>
                                        <th>Quote</th>
                                        <th>Gut</th>
                                        <th>TF</th>
                                        <th>G</th>
                                        <th>2'</th>
                                        <th>R</th>
                                        <th>WB</th>
                                    </tr>
                                </thead>
                                <tbody id="liveOverviewStatsBody"></tbody>
                            </table>

                            <h3 style="margin-top: 20px;">Gegner</h3>
                            <table id="liveOverviewStatsGegnerTable">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Tor</th>
                                        <th>Feldtore</th>
                                        <th>7m</th>
                                        <th>Fehlwurf</th>
                                        <th>Quote</th>
                                        <th>Gut</th>
                                        <th>TF</th>
                                        <th>G</th>
                                        <th>2'</th>
                                        <th>R</th>
                                        <th>WB</th>
                                    </tr>
                                </thead>
                                <tbody id="liveOverviewStatsGegnerBody"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Content: Heatmap -->
                    <div id="liveOverviewContentHeatmap" class="versteckt" style="text-align: center;">
                        <div class="heatmap-tabs" style="margin-top: 10px;">
                            <button class="heatmap-tab shadcn-btn-outline active"
                                id="liveOverviewSubTabTor">Tor</button>
                            <button class="heatmap-tab shadcn-btn-outline" id="liveOverviewSubTabFeld">Feld</button>
                            <button class="heatmap-tab shadcn-btn-outline"
                                id="liveOverviewSubTabKombi">Kombiniert</button>
                        </div>
                        <!-- Filters reuse history filters logic or new ones? -->
                        <!-- We can reuse IDs if we are careful, but better to use unique IDs and unified event handling -->
                        <div class="heatmap-filter">
                            <label><input type="radio" name="liveOverviewHeatTeam" value="heim" checked>
                                Heim</label>
                            <label><input type="radio" name="liveOverviewHeatTeam" value="gegner"> Gegner</label>
                            <span style="margin: 0 10px;">|</span>
                            <label><input type="checkbox" id="liveOverviewHeatmapToreFilter" checked>
                                Feldtore</label>
                            <label><input type="checkbox" id="liveOverviewHeatmap7mFilter"> 7m</label>
                            <label><input type="checkbox" id="liveOverviewHeatmapMissedFilter" checked>
                                Fehlwürfe</label>
                        </div>
                        <div id="liveOverviewHeatmapContainer"
                            style="display: flex; justify-content: center; padding: 20px;">
                            <svg id="liveOverviewHeatmapSvg" viewBox="0 0 300 200" width="600" height="400"
                                style="margin: 0 auto; display: block;"></svg>
                        </div>
                    </div>

                </div>

                <div class="shadcn-modal-footer">
                    <button class="shadcn-btn-outline" id="closeLiveGameOverview">Schließen</button>
                </div>
            </div>
        </div>


        <!-- Custom Confirm/Alert Modal -->
        <!-- Custom Confirm/Alert Modal (Shadcn Style) -->
        <div id="customConfirmModal" class="modal-overlay versteckt">
            <div class="shadcn-modal-content">
                <div class="shadcn-modal-header">
                    <h3 id="customConfirmTitle">Bestätigung</h3>
                    <p id="customConfirmMessage"></p>
                </div>
                <div class="shadcn-modal-footer">
                    <button id="customConfirmNo" class="shadcn-btn-outline">Abbrechen</button>
                    <button id="customConfirmYes" class="shadcn-btn-primary">Fortfahren</button>
                </div>
            </div>
        </div>

        <!-- Custom Alert Modal (nur OK Button) -->
        <!-- Custom Alert Modal (Shadcn Style) -->
        <div id="customAlertModal" class="modal-overlay versteckt">
            <div class="shadcn-modal-content">
                <div class="shadcn-modal-header">
                    <h3 id="customAlertTitle">Hinweis</h3>
                    <p id="customAlertMessage"></p>
                </div>
                <div class="shadcn-modal-footer">
                    <button id="customAlertOk" class="shadcn-btn-primary"
                        style="width: 100%; max-width: 100px;">OK</button>
                </div>
            </div>
        </div>

    </div> <!-- End of main-content -->

    <script type="module" src="main.js"></script>
    <script>
        // Initialize Lucide Icons
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
        } else {
            window.addEventListener('load', () => {
                if (typeof lucide !== 'undefined') lucide.createIcons();
            });
        }
    </script>
</body>

</html>